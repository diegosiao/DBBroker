ALTER SESSION SET "_ORACLE_SCRIPT"=true;

-- Create user and grant privileges
CREATE USER DBBROKER IDENTIFIED BY DBBroker_1 DEFAULT TABLESPACE users TEMPORARY TABLESPACE temp;
GRANT CONNECT, RESOURCE TO DBBROKER;

ALTER USER DBBROKER quota 200M on USERS;

-- Connect to the new schema
ALTER SESSION SET CURRENT_SCHEMA = DBBROKER;

-- Create the sequences and triggers for auto-increment
CREATE SEQUENCE CUSTOMERS_NOTES_STATUS_SEQ START WITH 1 INCREMENT BY 1 NOCACHE;
CREATE SEQUENCE ORDERS_NOTES_SEQ START WITH 1 INCREMENT BY 1 NOCACHE;
CREATE SEQUENCE ORDER_STATUS_SEQ START WITH 1 INCREMENT BY 1 NOCACHE;
CREATE SEQUENCE PROMOTIONS_SEQ START WITH 1 INCREMENT BY 1 NOCACHE;
CREATE SEQUENCE PROMOTIONS_ENROLLMENTS_SEQ START WITH 1 INCREMENT BY 1 NOCACHE;

-- Create the tables
CREATE TABLE ADDRESS (
    ID RAW(16) PRIMARY KEY,
    STREET VARCHAR2(100),
    CITY VARCHAR2(50),
    STATE VARCHAR2(50),
    POSTAL_CODE VARCHAR2(10),
    COUNTRY VARCHAR2(50)
);

CREATE TABLE CUSTOMERS (
    ID RAW(16) PRIMARY KEY,
    ADDRESS_ID RAW(16),
    NAME VARCHAR2(250) NOT NULL,
    BIRTHDAY DATE,
    ORDERS_TOTAL NUMBER,
    CREATED_AT TIMESTAMP NOT NULL,
    CREATED_BY VARCHAR2(50) NOT NULL,
    MODIFIED_AT TIMESTAMP,
    MODIFIED_BY VARCHAR2(50),
    CONSTRAINT FK_CUSTOMERS_ADDRESS_ID FOREIGN KEY (ADDRESS_ID) REFERENCES ADDRESS(ID)
);

CREATE TABLE CUSTOMERS_NOTES_STATUS (
    ID NUMBER PRIMARY KEY,
    STATUS VARCHAR2(50)
);

CREATE TABLE CUSTOMERS_NOTES (
    ID RAW(16) PRIMARY KEY,
    CUSTOMER_ID RAW(16),
    STATUS_ID NUMBER,
    NOTE_CONTENT VARCHAR2(50) NOT NULL,
    CONSTRAINT FK_CUSTOMERS_NOTES_CUSTOMER_ID FOREIGN KEY (CUSTOMER_ID) REFERENCES CUSTOMERS(ID),
    CONSTRAINT FK_CUSTOMERS_NOTES_STATUS_ID FOREIGN KEY (STATUS_ID) REFERENCES CUSTOMERS_NOTES_STATUS(ID)
);

CREATE TABLE ORDER_STATUS (
    ID NUMBER PRIMARY KEY,
    STATUS VARCHAR2(50) NOT NULL
);

CREATE TABLE ORDERS (
    ID RAW(16) PRIMARY KEY,
    CUSTOMER_ID RAW(16) NOT NULL,
    STATUS_ID NUMBER,
    CREATED_AT TIMESTAMP NOT NULL,
    CREATED_BY VARCHAR2(50) NOT NULL,
    MODIFIED_AT TIMESTAMP,
    MODIFIED_BY VARCHAR2(50),
    CONSTRAINT FK_ORDERS_CUSTOMER_ID FOREIGN KEY (CUSTOMER_ID) REFERENCES CUSTOMERS(ID),
    CONSTRAINT FK_ORDERS_STATUS_ID FOREIGN KEY (STATUS_ID) REFERENCES ORDER_STATUS(ID)
);

CREATE TABLE ORDERS_NOTES (
    ID NUMBER PRIMARY KEY,
    ORDER_ID RAW(16) NOT NULL,
    NOTE_CONTENT VARCHAR2(1024) NOT NULL,
    CONSTRAINT FK_ORDERS_NOTES_ORDER_ID FOREIGN KEY (ORDER_ID) REFERENCES ORDERS(ID)
);

CREATE TABLE PRODUCTS (
    ID RAW(16) PRIMARY KEY,
    PRODUCT_NAME VARCHAR2(50) NOT NULL,
    PRICE NUMBER(10, 2) DEFAULT 0
);

CREATE TABLE ORDERS_PRODUCTS (
    ID RAW(16) PRIMARY KEY,
    ORDER_ID RAW(16) NOT NULL,
    PRODUCT_ID RAW(16) NOT NULL,
    CONSTRAINT FK_ORDERS_PRODUCTS_ORDER_ID FOREIGN KEY (ORDER_ID) REFERENCES ORDERS(ID),
    CONSTRAINT FK_ORDERS_PRODUCTS_PRODUCT_ID FOREIGN KEY (PRODUCT_ID) REFERENCES PRODUCTS(ID)
);

CREATE TABLE PROMOTIONS (
    ID NUMBER PRIMARY KEY,
    TITLE VARCHAR2(50) NOT NULL,
    EXPIRATION TIMESTAMP NOT NULL
);

CREATE TABLE PROMOTIONS_ENROLLMENTS (
    ID NUMBER PRIMARY KEY,
    CUSTOMER_ID RAW(16) NOT NULL,
    PROMOTION_ID NUMBER NOT NULL,
    CONSTRAINT FK_PROMO_ENRO_CUSTOMER_ID FOREIGN KEY (CUSTOMER_ID) REFERENCES CUSTOMERS(ID),
    CONSTRAINT FK_PROMO_ENRO_PROMOTION_ID FOREIGN KEY (PROMOTION_ID) REFERENCES PROMOTIONS(ID)
);

-- Add a comment to the primary key column
COMMENT ON COLUMN CUSTOMERS.ID IS 'Primary key';

--- SEEDING DATA ---

INSERT INTO ADDRESS(ID, STREET, CITY, STATE, POSTAL_CODE, COUNTRY)
VALUES(HEXTORAW('A1B2C3D4E5F60718293A4B5C6D7E8F90'), '123 Main St', 'Springfield', 'IL', '62701', 'USA');

INSERT INTO ADDRESS(ID, STREET, CITY, STATE, POSTAL_CODE, COUNTRY)
VALUES(HEXTORAW('1234567890ABCDEF1234567890ABCDEF'), '456 Elm St', 'Springfield', 'IL', '62702', 'USA');

INSERT INTO ADDRESS(ID, STREET, CITY, STATE, POSTAL_CODE, COUNTRY)
VALUES(HEXTORAW('FEDCBA0987654321FEDCBA0987654321'), '789 Oak St', 'Springfield', 'IL', '62703', 'USA');

INSERT INTO CUSTOMERS(ID, ADDRESS_ID, NAME, BIRTHDAY, ORDERS_TOTAL, CREATED_AT, CREATED_BY)
VALUES(HEXTORAW('00112233445566778899AABBCCDDEEFF'), HEXTORAW('A1B2C3D4E5F60718293A4B5C6D7E8F90'), 'John Doe', TO_DATE('1980-05-15', 'YYYY-MM-DD'), 0, SYSTIMESTAMP, 'system');

INSERT INTO CUSTOMERS(ID, ADDRESS_ID, NAME, BIRTHDAY, ORDERS_TOTAL, CREATED_AT, CREATED_BY)
VALUES(HEXTORAW('FFEEDDCCBBAA99887766554433221100'), HEXTORAW('1234567890ABCDEF1234567890ABCDEF'), 'Jane Smith', TO_DATE('1990-08-22', 'YYYY-MM-DD'), 0, SYSTIMESTAMP, 'system');

INSERT INTO CUSTOMERS(ID, ADDRESS_ID, NAME, BIRTHDAY, ORDERS_TOTAL, CREATED_AT, CREATED_BY)
VALUES(HEXTORAW('89ABCDEF0123456789ABCDEF01234567'), HEXTORAW('FEDCBA0987654321FEDCBA0987654321'), 'Alice Johnson', TO_DATE('1985-12-05', 'YYYY-MM-DD'), 0, SYSTIMESTAMP, 'system');

INSERT INTO CUSTOMERS_NOTES_STATUS(ID, STATUS)
VALUES(CUSTOMERS_NOTES_STATUS_SEQ.nextval, 'Active');

INSERT INTO CUSTOMERS_NOTES_STATUS(ID, STATUS)
VALUES(CUSTOMERS_NOTES_STATUS_SEQ.nextval, 'Inactive');

INSERT INTO CUSTOMERS_NOTES(ID, CUSTOMER_ID, STATUS_ID, NOTE_CONTENT)
VALUES(HEXTORAW('ABCDEF1234567890ABCDEF1234567890'), HEXTORAW('00112233445566778899AABBCCDDEEFF'), 1, 'First note for John Doe.');

INSERT INTO CUSTOMERS_NOTES(ID, CUSTOMER_ID, STATUS_ID, NOTE_CONTENT)
VALUES(HEXTORAW('1234567890ABCDEF1234567890ABCDEF'), HEXTORAW('00112233445566778899AABBCCDDEEFF'), 1, 'Second note for John Doe.');

INSERT INTO PRODUCTS(ID, PRODUCT_NAME, PRICE)
VALUES(HEXTORAW('2468ACE13579BDF02468ACE13579BDF0'), 'Product A', 5.99);

INSERT INTO PRODUCTS(ID, PRODUCT_NAME, PRICE)
VALUES(HEXTORAW('13579BDF2468ACE013579BDF2468ACE0'), 'Product B', 15.49);

INSERT INTO PRODUCTS(ID, PRODUCT_NAME, PRICE)
VALUES(HEXTORAW('0F1E2D3C4B5A69780F1E2D3C4B5A6978'), 'Product C', 25.00);

INSERT INTO PRODUCTS(ID, PRODUCT_NAME, PRICE)
VALUES(HEXTORAW('9F8E7D6C5B4A3B29F8E7D6C5B4A3B29'), 'Product D', 45.75);

INSERT INTO ORDER_STATUS(ID, STATUS)
VALUES(ORDER_STATUS_SEQ.nextval, 'New');

INSERT INTO ORDER_STATUS(ID, STATUS)
VALUES(ORDER_STATUS_SEQ.nextval, 'Pending');

INSERT INTO ORDER_STATUS(ID, STATUS)
VALUES(ORDER_STATUS_SEQ.nextval, 'Finished');

INSERT INTO ORDER_STATUS(ID, STATUS)
VALUES(ORDER_STATUS_SEQ.nextval, 'Canceled');

INSERT INTO ORDERS(ID, CUSTOMER_ID, STATUS_ID, CREATED_AT, CREATED_BY)
VALUES(HEXTORAW('ABCDEF1234567890ABCDEF1234567890'), HEXTORAW('00112233445566778899AABBCCDDEEFF'), 1, SYSTIMESTAMP, 'system');

INSERT INTO ORDERS_PRODUCTS(ID, ORDER_ID, PRODUCT_ID)
VALUES(HEXTORAW('11223344556677889900AABBCCDDEEFF'), HEXTORAW('ABCDEF1234567890ABCDEF1234567890'), HEXTORAW('2468ACE13579BDF02468ACE13579BDF0'));

INSERT INTO ORDERS_PRODUCTS(ID, ORDER_ID, PRODUCT_ID)
VALUES(HEXTORAW('FFEEDDCCBBAA99887766554433221100'), HEXTORAW('ABCDEF1234567890ABCDEF1234567890'), HEXTORAW('13579BDF2468ACE013579BDF2468ACE0'));   

INSERT INTO ORDERS_PRODUCTS(ID, ORDER_ID, PRODUCT_ID)
VALUES(HEXTORAW('A1B2C3D4E5F60718293A4B5C6D7E8F90'), HEXTORAW('ABCDEF1234567890ABCDEF1234567890'), HEXTORAW('0F1E2D3C4B5A69780F1E2D3C4B5A6978')); 

INSERT INTO ORDERS_NOTES(ID, ORDER_ID, NOTE_CONTENT)
VALUES(ORDERS_NOTES_SEQ.nextval, HEXTORAW('ABCDEF1234567890ABCDEF1234567890'), 'First note for the order.');

INSERT INTO ORDERS_NOTES(ID, ORDER_ID, NOTE_CONTENT)
VALUES(ORDERS_NOTES_SEQ.nextval, HEXTORAW('ABCDEF1234567890ABCDEF1234567890'), 'Second note for the order.');

INSERT INTO ORDERS_NOTES(ID, ORDER_ID, NOTE_CONTENT)
VALUES(ORDERS_NOTES_SEQ.nextval, HEXTORAW('ABCDEF1234567890ABCDEF1234567890'), 'Third note for the order.');

INSERT INTO ORDERS_NOTES(ID, ORDER_ID, NOTE_CONTENT)
VALUES(ORDERS_NOTES_SEQ.nextval, HEXTORAW('ABCDEF1234567890ABCDEF1234567890'), 'Fourth note for the order.'); 

INSERT INTO ORDERS_NOTES(ID, ORDER_ID, NOTE_CONTENT)
VALUES(ORDERS_NOTES_SEQ.nextval, HEXTORAW('ABCDEF1234567890ABCDEF1234567890'), 'Fifth note for the order.');

INSERT INTO ORDERS(ID, CUSTOMER_ID, STATUS_ID, CREATED_AT, CREATED_BY)
VALUES(HEXTORAW('1234567890ABCDEF1234567890ABCDEF'), HEXTORAW('FFEEDDCCBBAA99887766554433221100'), 2, SYSTIMESTAMP, 'system');

INSERT INTO ORDERS_PRODUCTS(ID, ORDER_ID, PRODUCT_ID)
VALUES(HEXTORAW('22334455667788990011AABBCCDDEEFF'), HEXTORAW('1234567890ABCDEF1234567890ABCDEF'), HEXTORAW('9F8E7D6C5B4A3B29F8E7D6C5B4A3B29'));

INSERT INTO ORDERS_PRODUCTS(ID, ORDER_ID, PRODUCT_ID)
VALUES(HEXTORAW('EEFFDDBBCCAA99887766554433221100'), HEXTORAW('1234567890ABCDEF1234567890ABCDEF'), HEXTORAW('2468ACE13579BDF02468ACE13579BDF0'));

INSERT INTO ORDERS_NOTES(ID, ORDER_ID, NOTE_CONTENT)
VALUES(ORDERS_NOTES_SEQ.nextval, HEXTORAW('1234567890ABCDEF1234567890ABCDEF'), 'First note for the second order.');

INSERT INTO ORDERS_NOTES(ID, ORDER_ID, NOTE_CONTENT)
VALUES(ORDERS_NOTES_SEQ.nextval, HEXTORAW('1234567890ABCDEF1234567890ABCDEF'), 'Second note for the second order.');

INSERT INTO ORDERS(ID, CUSTOMER_ID, STATUS_ID, CREATED_AT, CREATED_BY)
VALUES(HEXTORAW('0F1E2D3C4B5A69780F1E2D3C4B5A6978'), HEXTORAW('89ABCDEF0123456789ABCDEF01234567'), 3, SYSTIMESTAMP, 'system');

INSERT INTO ORDERS_PRODUCTS(ID, ORDER_ID, PRODUCT_ID)
VALUES(HEXTORAW('33445566778899001122AABBCCDDEEFF'), HEXTORAW('0F1E2D3C4B5A69780F1E2D3C4B5A6978'), HEXTORAW('13579BDF2468ACE013579BDF2468ACE0'));

INSERT INTO ORDERS_PRODUCTS(ID, ORDER_ID, PRODUCT_ID)
VALUES(HEXTORAW('DDEEFF00112233445566778899AABBCC'), HEXTORAW('0F1E2D3C4B5A69780F1E2D3C4B5A6978'), HEXTORAW('0F1E2D3C4B5A69780F1E2D3C4B5A6978'));

INSERT INTO ORDERS_NOTES(ID, ORDER_ID, NOTE_CONTENT)
VALUES(ORDERS_NOTES_SEQ.nextval, HEXTORAW('0F1E2D3C4B5A69780F1E2D3C4B5A6978'), 'First note for the third order.');

INSERT INTO PROMOTIONS(ID, TITLE, EXPIRATION)
VALUES(PROMOTIONS_SEQ.nextval, 'Spring Sale', SYSTIMESTAMP + INTERVAL '30' DAY);

INSERT INTO PROMOTIONS(ID, TITLE, EXPIRATION)
VALUES(PROMOTIONS_SEQ.nextval, 'Summer Sale', SYSTIMESTAMP + INTERVAL '60' DAY);

INSERT INTO PROMOTIONS_ENROLLMENTS(ID, CUSTOMER_ID, PROMOTION_ID)
VALUES(PROMOTIONS_ENROLLMENTS_SEQ.nextval, HEXTORAW('00112233445566778899AABBCCDDEEFF'), 1);

INSERT INTO PROMOTIONS_ENROLLMENTS(ID, CUSTOMER_ID, PROMOTION_ID)
VALUES(PROMOTIONS_ENROLLMENTS_SEQ.nextval, HEXTORAW('FFEEDDCCBBAA99887766554433221100'), 1);

INSERT INTO PROMOTIONS_ENROLLMENTS(ID, CUSTOMER_ID, PROMOTION_ID)
VALUES(PROMOTIONS_ENROLLMENTS_SEQ.nextval, HEXTORAW('89ABCDEF0123456789ABCDEF01234567'), 2);

INSERT INTO PROMOTIONS_ENROLLMENTS(ID, CUSTOMER_ID, PROMOTION_ID)
VALUES(PROMOTIONS_ENROLLMENTS_SEQ.nextval, HEXTORAW('00112233445566778899AABBCCDDEEFF'), 2);

COMMIT;