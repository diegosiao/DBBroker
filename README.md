<div align="center">
  <img src="/assets/logo-with-name.png" alt="DBBroker logo" />
  <br/>
  A lightweight and easy to use .NET tool and library for effortless database records manipulation.
</div>

## NuGet

| Package | Latest |
|----|----|
| DBBroker | ![NuGet Version](https://img.shields.io/nuget/v/dbbroker) |
| DBBroker.Cli | ![NuGet Version](https://img.shields.io/nuget/v/dbbroker.cli) |

## What It Does?

Differently from another popular ORM packages, DBBroker approach associates a [CLI](https://nuget.org/dbbroker.cli) to automatically generate **Data Models** and a [library](https://nuget.org/dbbroker) that uses those Data Models at runtime to manipulate database records.

## Philosophy

DBBroker offers features that benefit any kind of application, from the simplest to the most complex, particularly in security-restricted scenarios. Here are some key requirements it addresses:

- Applications should **NOT** be responsible for executing [DDL](https://en.wikipedia.org/wiki/Data_definition_language).

- Applications' Data Access Objects should act as **clients** to the database, not the other way around.

- [Schema Migrations](https://en.wikipedia.org/wiki/Schema_migration) are not an option due to a development process led by **Database Administrators**.

These are common needs for many organizations with database-centered solutions, such as the one where this tool was initially developed.

## Quick Start

Open your terminal and navigate to your application's *.csproj directory. Then follow these steps:

**Step 1:** Install `DBBroker.Cli` .NET tool globally.

```bash
dotnet install DBBroker.Cli -g
```

**Step 2:** Add `DBBroker` package to your project.

```bash
dotnet nuget add DBBroker
```

**Step 3:** Create a `dbbroker.config.json` file at the root of your project.

```bash
dbbroker init --namespace="EShop.DataModels" --connection-string "[database-connection-string]" --provider Oracle
```

**Step 4:** Synchronize your project with your database to generate the Data Models.

```bash
dbbroker sync
```

## Examples

Entity persistence.

```C#
// Data Models classes are generated by DBBroker (dbbroker sync)
var customer = new CustomersDataModel();
customer.Name = "John Three Sixteen";
customer.Birthday = new DateTime(1980, 3, 16);

var id = await _dbBroker.InsertAsync(customer);
```

Entity persistence with transactions.

```C#
using var connection = new SqlConnection();
connection.Open();
var transaction = connection.GetTransaction();

try 
{
    var customer = new CustomersDataModel();
    customer.Id = Guid.NewGuid();
    customer.Name = "John Three Sixteen";
    customer.Birthday = new DateTime(1980, 3, 16);

    await connection.InsertAsync(customer, transaction);

    var car = new CarEdm();
    car.Model = "Renault Twingo";
    car.Year = 2001;
    car.CustomerId = customer.Id;

    await connection.InsertAsync(car, transaction);
    transaction.Commit();
}
catch(Exception ex)
{
    transaction.Rollback();
}
```

Retrieving a record.

```C#
var customer = await connection.GetByKey<CustomersDataModel>("543491fa-788a-474c-9f3b-6ed6566e5d2c");
```

Retrieving multiple and filtered records.

```C#
var inactiveCustomers = await connection.Select<CustomersDataModel>()
  .AddFilter(x => x.StatusId, SqlEquals.To(3))
  .FetchFirst(records: 100, skip: 300) // helps implement a 'load more' strategy
  .ExecuteAsync();
```

```C#
// another example with columns
```

```C#
// another example with columns and order by
```

## Supported Databases

| Database | Status |
|----------|--------|
| SQL Server | ‚úÖ |
| Oracle | ‚úÖ |
| Postgres | ‚öíÔ∏è |
| MySQL | üõ£Ô∏è |

## Contribute

We appreciate all contributions, whether they're bug reports, feature suggestions, or pull requests. Thank you for your interest and support in improving this project!

Financial support is also welcome, large or small contributions will help to keep this project moving and always secure.

[![BuyMeACoffee](https://raw.githubusercontent.com/pachadotdev/buymeacoffee-badges/main/bmc-donate-yellow.svg)](https://www.buymeacoffee.com/diegosiao)
