<div align="center">
  <img src="/assets/logo-with-name.png" alt="DBBroker logo" />
  <br/>
  A lightweight and easy to use .NET tool and library for effortless database records manipulation.
</div>

## NuGet

| Package | Latest | |
|----|----|----|
| DBBroker | ![NuGet Version](https://img.shields.io/nuget/v/dbbroker) | [.NET Standard 2.0](https://learn.microsoft.com/en-us/dotnet/standard/net-standard?tabs=net-standard-2-0#select-net-standard-version) |
| DBBroker.Cli | ![NuGet Version](https://img.shields.io/nuget/v/dbbroker.cli) | |

**IMPORTANT:** This version has no backward compatibility with DBBroker 1.x and 2.x.

## What It Does?

Differently from another popular ORM packages, DBBroker approach associates a [.NET CLI tool](https://nuget.org/dbbroker.cli) to generate **Entity Data Models** and a [library](https://nuget.org/dbbroker) that uses those Entity Data Models at runtime to manipulate database records.

## Philosophy

DBBroker's philosophy is based on the idea of reflecting database tables and views structure state into C# Entity Data Models classes used to perform database SQL commands like INSERT, UPSERT, UPDATE, DELETE, and SELECT with minimal effort and boilerplate.

Here are some key requirements this philosophy addresses:

- Applications should **NOT** be responsible for executing [DDL](https://en.wikipedia.org/wiki/Data_definition_language) commands.

- Applications' Data Access Objects should act as **clients** to the database, not the other way around.

- [Schema Migrations](https://en.wikipedia.org/wiki/Schema_migration) are not an option due to a development process led by **Database Administrators**.

These are common requirements for many organizations or database-centered applications.

## Quick Start

Open your terminal and navigate to your application's *.csproj directory. Then follow these steps:

**Step 1:** Install `DBBroker.Cli` .NET tool globally.

```bash
dotnet tool install DBBroker.Cli --global
```

**Step 2:** Add `DBBroker` package to your project.

```bash
dotnet nuget add DBBroker
```

**Step 3:** Create a `dbbroker.config.json` file at the root of your project.

```bash
dbbroker init --namespace="MyApp.DataModels" --connection-string "[database-connection-string]" --provider Oracle
```

**Step 4:** Synchronize your project with your database schemas to generate the Data Models.

```bash
dbbroker sync
```

## Examples

Entity persistence.

```C#
// Data Models classes are generated by DBBroker (dbbroker sync)
var customer = new CustomersDataModel();
customer.Name = "John Three Sixteen";
customer.Birthday = new DateTime(1980, 3, 16);

var id = await connection.Insert(customer);
```

Entity persistence with transactions.

```C#
using var connection = new SqlConnection();
connection.Open();
var transaction = connection.GetTransaction();

try 
{
    var customer = new CustomersDataModel();
    customer.Id = Guid.NewGuid();
    customer.Name = "John Three Sixteen";
    customer.Birthday = new DateTime(1980, 3, 16);

    await connection.InsertAsync(customer, transaction);

    var car = new CarEdm();
    car.Model = "Renault Twingo";
    car.Year = 2001;
    car.CustomerId = customer.Id;

    await connection.InsertAsync(car, transaction);
    transaction.Commit();
}
catch(Exception ex)
{
    transaction.Rollback();
}
```

Retrieving a record.

```C#
var customer = await connection.GetByKey<CustomersDataModel>("543491fa-788a-474c-9f3b-6ed6566e5d2c");
```

Retrieving multiple and filtered records.

```C#
var inactiveCustomers = await connection.Select<CustomersDataModel>()
  .AddFilter(x => x.StatusId, SqlEquals.To(3))
  .FetchFirst(records: 100, skip: 300) // helps implement a 'load more' or pagination strategy
  .ExecuteAsync();
```

```C#
// another example with columns
```

```C#
// another example with columns and order by
```

## Supported Databases

| Database | Status | --provider |
|----------|--------|--------|
| SQL Server | ‚úÖ | SqlServer |
| Oracle | ‚úÖ | Oracle |
| Postgres | ‚öíÔ∏è | Postgres |
| MySQL | üõ£Ô∏è | MySql |

## Contribute

We appreciate all contributions, whether they're bug reports, feature suggestions, or pull requests. Thank you for your interest and support in improving this project!

Financial support is also welcome, whether large or small contributions will help to keep this project moving and always secure.

[![BuyMeACoffee](https://raw.githubusercontent.com/pachadotdev/buymeacoffee-badges/main/bmc-donate-yellow.svg)](https://www.buymeacoffee.com/diegosiao)
