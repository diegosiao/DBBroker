# DBBroker 3.x

![DbBroker logo](/assets/logo-with-name.png "logo")

A lightweight and easy to use .NET tool and library for effortless database records manipulation.

## Benefits

- Automatically generated Data Models
- Zero-SQL
- Compile time database compatibility and change check

## NuGet

| Package | Latest | |
|----|----|----|
| [DBBroker](https://www.nuget.org/packages/DBBroker) | ![NuGet Version](https://img.shields.io/nuget/v/dbbroker) | [.NET Standard 2.0](https://learn.microsoft.com/en-us/dotnet/standard/net-standard?tabs=net-standard-2-0#select-net-standard-version) |
| [DBBroker.Cli](https://www.nuget.org/packages/DBBroker.Cli) | ![NuGet Version](https://img.shields.io/nuget/v/dbbroker.cli) | |

**IMPORTANT:** This version has no backward compatibility with DBBroker 1.x and 2.x.

## How it works?

DBBroker approach is powerful and different from other ORMs because it associates a [.NET CLI tool](https://nuget.org/dbbroker.cli) to automatically generate **Data Models** and a [library](https://nuget.org/dbbroker) that uses those Data Models at runtime to generate SQL and manipulate database records.

## Philosophy

DBBroker offers features that benefit any kind of application, from the simplest to the most complex, particularly in security-restricted scenarios. Here are some key requirements it addresses:

- Applications should **NOT** be responsible for executing [DDL](https://en.wikipedia.org/wiki/Data_definition_language).

- Applications' Data Access Objects should act as **clients** to the database, not the other way around.

- [Schema Migrations](https://en.wikipedia.org/wiki/Schema_migration) are not an option due to a development process led by **Database Administrators**.

These are common requirements for many organizations or database-centered solutions, and, arguably, by everyone who likes to keep things simple.

## Quick Start‚ö°

Open your terminal and navigate to your application's *.csproj directory. Then follow these steps:

**Step 1:** Install `DBBroker.Cli` .NET tool globally.

```bash
dotnet tool install DBBroker.Cli --global
```

**Step 2:** Add `DBBroker` package to your project.

```bash
dotnet nuget add DBBroker
```

**Step 3:** Create a `dbbroker.config.json` file at the root of your project.

```bash
dbbroker init --namespace="MyApp.DataModels" --connection-string "<my_connection_string>" --provider Oracle
```

**Step 4:** Synchronize your project with your database schemas to generate the Data Models.

```bash
dbbroker sync
```

## Examples

Entity persistence.

```C#
// Data Models classes are generated by DBBroker (dbbroker sync)
var customer = new CustomersDataModel();
customer.Name = "John Three Sixteen";
customer.Birthday = new DateTime(1980, 3, 16);

var id = await dbConnection.InsertAsync(customer);
```

Entity persistence with transactions.

```C#
using var dbConnection = new SqlConnection();
dbConnection.Open();
var transaction = dbConnection.GetTransaction();

try 
{
    var customer = new CustomersDataModel();
    customer.Id = Guid.NewGuid();
    customer.Name = "John Three Sixteen";
    customer.Birthday = new DateTime(1980, 3, 16);

    await dbConnection.InsertAsync(customer, transaction);

    var car = new CarsDataModel();
    car.Model = "Renault Twingo";
    car.Year = 2001;
    car.CustomerId = customer.Id;

    await dbConnection.InsertAsync(car, transaction);
    transaction.Commit();
}
catch(Exception ex)
{
    transaction.Rollback();
}
```

Retrieving a record.

```C#
var result = await dbConnection
    .Select<CustomersDataModel>()
    .AddFilter(x => x.Id, SqlEquals.To("1e6fc0e6-1fe2-49c0-ba37-ec14bf8eddc4"))
    .ExecuteAsync();

var customer = result.FirstOrDefault();
```

Retrieving multiple and filtered records.

```C#
var inactiveCustomers = await dbConnection.Select<CustomersDataModel>()
  .AddFilter(x => x.StatusId, SqlEquals.To(3))
  .ExecuteAsync();
```

Retrieving multiple records loading only specified columns.

```C#
var inactiveCustomers = await dbConnection
    .Select<CustomersDataModel>([
        x => x.Id,
        x => x.Name,
        x => x.Birthday
    ])
    .OrderBy(x => x.Name)
    .AddFilter(x => x.StatusId, SqlEquals.To(3))
    .ExecuteAsync();
```

## Supported Databases

| Database | Status | --provider |
|----------|--------|--------|
| SQL Server | ‚úÖ | SqlServer |
| Oracle | ‚úÖ | Oracle |
| Postgres | ‚öíÔ∏è | Postgres |
| MySQL | üõ£Ô∏è | MySql |

## Contribute

All contributions are appreciated, whether they're bug reports, feature suggestions, or pull requests. Thank you for your interest and support in improving this project!

Financial support is also welcome, whether large or small contributions will help to keep this project moving and always secure.

[![BuyMeACoffee](https://raw.githubusercontent.com/pachadotdev/buymeacoffee-badges/main/bmc-donate-yellow.svg)](https://www.buymeacoffee.com/diegosiao)
